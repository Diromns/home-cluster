apiVersion: v1
kind: Pod
metadata:
  name: kube-vip
  namespace: kube-system
  labels:
    name: kube-vip
spec:
  containers:
    - name: kube-vip
      image: plndr/kube-vip:0.3.4
      args:
      - manager
      env:
      - name: vip_arp
        value: "true"
      - name: vip_interface
        value: {{ kube_vip.listen_interface }}
      - name: port
        value: "6443"
      - name: vip_cidr
        value: "32"
      - name: cp_enable
        value: "true"
      - name: cp_namespace
        value: kube-system
      - name: svc_enable
        value: "false"
      - name: vip_leaderelection
        value: "true"
      - name: vip_leaseduration
        value: "5"
      - name: vip_renewdeadline
        value: "3"
      - name: vip_retryperiod
        value: "1"
      - name: vip_address
        value: "{{ k3s_registration_address }}"
      securityContext:
        capabilities:
          add:
          - NET_ADMIN
          - NET_RAW
          - SYS_TIME
      volumeMounts:
      - mountPath: /etc/kubernetes/admin.conf
        name: kubeconfig
  hostNetwork: true
  volumes:
  - hostPath:
      path: /etc/rancher/k3s/k3s.yaml
    name: kubeconfig
